# =============================================================================
# Absolute Palworld Server - Docker Compose Configuration
# =============================================================================
# Usage:
#   1. Edit the environment variables below to customize your server
#   2. Run: docker compose up -d
#   3. View logs: docker compose logs -f
#   4. Stop: docker compose down
# =============================================================================

services:
  palworld:
    build:
      context: .
      dockerfile: Dockerfile
    image: absolute-palworld-server:latest
    container_name: palworld-server

    # =========================================================================
    # SERVER CONFIGURATION
    # =========================================================================
    # Edit these values to customize your server
    # =========================================================================
    environment:
      # -----------------------------------------------------------------------
      # SERVER SETTINGS
      # -----------------------------------------------------------------------

      # Server name displayed in the server browser
      - SERVER_NAME=My Palworld Server

      # UDP port for game traffic
      - SERVER_PORT=8211

      # Server description
      - SERVER_DESCRIPTION=

      # Server password (leave empty for no password)
      - SERVER_PASSWORD=

      # Admin password for RCON commands
      - ADMIN_PASSWORD=

      # Whether the server appears in the public server browser
      - SERVER_PUBLIC=true

      # Maximum number of players
      - MAX_PLAYERS=32

      # Additional server arguments (advanced)
      - SERVER_ARGS=

      # -----------------------------------------------------------------------
      # GAME SETTINGS
      # -----------------------------------------------------------------------

      # Difficulty: None, Normal, Difficult
      - DIFFICULTY=None

      # Time speed multipliers
      - DAY_TIME_SPEED_RATE=1.0
      - NIGHT_TIME_SPEED_RATE=1.0

      # Experience and capture rates
      - EXP_RATE=1.0
      - PAL_CAPTURE_RATE=1.0
      - PAL_SPAWN_NUM_RATE=1.0

      # Damage rates
      - PAL_DAMAGE_RATE_ATTACK=1.0
      - PAL_DAMAGE_RATE_DEFENSE=1.0
      - PLAYER_DAMAGE_RATE_ATTACK=1.0
      - PLAYER_DAMAGE_RATE_DEFENSE=1.0

      # Player stats
      - PLAYER_STOMACH_DECREASE_RATE=1.0
      - PLAYER_STAMINA_DECREASE_RATE=1.0
      - PLAYER_AUTO_HP_REGEN_RATE=1.0
      - PLAYER_AUTO_HP_REGEN_RATE_IN_SLEEP=1.0

      # Building and collection
      - BUILD_OBJECT_DAMAGE_RATE=1.0
      - BUILD_OBJECT_DETERIORATION_DAMAGE_RATE=1.0
      - COLLECTION_DROP_RATE=1.0
      - COLLECTION_OBJECT_HP_RATE=1.0
      - COLLECTION_OBJECT_RESPAWN_SPEED_RATE=1.0
      - ENEMY_DROP_ITEM_RATE=1.0

      # Death penalty: None, Item, ItemAndEquipment, All
      - DEATH_PENALTY=All

      # PvP and combat settings
      - ENABLE_PLAYER_TO_PLAYER_DAMAGE=false
      - ENABLE_FRIENDLY_FIRE=false
      - ENABLE_INVADER_ENEMY=true
      - IS_PVP=false

      # Miscellaneous
      - ENABLE_AIM_ASSIST_PAD=true
      - ENABLE_AIM_ASSIST_KEYBOARD=false
      - DROP_ITEM_MAX_NUM=3000
      - BASE_CAMP_MAX_NUM=128
      - BASE_CAMP_WORKER_MAX_NUM=15
      - DROP_ITEM_ALIVE_MAX_HOURS=1.0
      - GUILD_PLAYER_MAX_NUM=20
      - PAL_EGG_DEFAULT_HATCHING_TIME=72.0
      - WORK_SPEED_RATE=1.0
      - ENABLE_FAST_TRAVEL=true
      - COOP_PLAYER_MAX_NUM=4
      - SERVER_PLAYER_MAX_NUM=32

      # -----------------------------------------------------------------------
      # RCON SETTINGS
      # -----------------------------------------------------------------------

      # Enable RCON for remote administration
      - RCON_ENABLED=false
      - RCON_PORT=25575

      # -----------------------------------------------------------------------
      # UPDATE SETTINGS
      # -----------------------------------------------------------------------

      # Automatically update server files on container start/restart
      - UPDATE_ON_START=true

      # Maximum time (seconds) to wait for update to complete
      - UPDATE_TIMEOUT=900

      # Cron schedule for automatic updates during runtime (empty = disabled)
      # Example: */30 * * * * (every 30 minutes)
      - UPDATE_CRON=

      # Only update when no players are connected
      - UPDATE_IF_IDLE=true

      # Additional SteamCMD arguments for updates
      - STEAMCMD_ARGS=validate

      # -----------------------------------------------------------------------
      # BACKUP SETTINGS
      # -----------------------------------------------------------------------

      # Enable automatic backups
      - BACKUPS_ENABLED=true

      # Cron schedule for backups (default: every hour)
      - BACKUPS_CRON=0 * * * *

      # Backup storage directory (inside container)
      - BACKUPS_DIRECTORY=/config/backups

      # Maximum age of backups in days (0 = no limit)
      - BACKUPS_MAX_AGE=3

      # Maximum number of backups to keep (0 = no limit)
      - BACKUPS_MAX_COUNT=0

      # Compress backups using ZIP
      - BACKUPS_ZIP=true

      # Only backup when no players are connected
      - BACKUPS_IF_IDLE=false

      # -----------------------------------------------------------------------
      # PERMISSION SETTINGS
      # -----------------------------------------------------------------------

      # User/Group ID to run the server as (match to host user for file perms)
      - PUID=1000
      - PGID=1000

      # File creation umask
      - PERMISSIONS_UMASK=022

      # -----------------------------------------------------------------------
      # SYSTEM SETTINGS
      # -----------------------------------------------------------------------

      # Container timezone (https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
      - TZ=Etc/UTC

      # -----------------------------------------------------------------------
      # LOG FILTERING
      # -----------------------------------------------------------------------

      # Filter empty lines from server output
      - LOG_FILTER_EMPTY=true

      # Filter invalid UTF-8 characters
      - LOG_FILTER_UTF8=true

      # Additional patterns to filter (pipe-separated)
      - LOG_FILTER_CONTAINS=

    # =========================================================================
    # NETWORK CONFIGURATION
    # =========================================================================
    # Port mappings
    # 8211/udp - Game traffic
    # 27015/udp - Steam server queries
    # 25575/tcp - RCON (only needed if RCON_ENABLED=true)
    ports:
      - "8211:8211/udp"
      - "27015:27015/udp"
      - "25575:25575/tcp"

    # =========================================================================
    # STORAGE CONFIGURATION
    # =========================================================================
    volumes:
      # Persistent data: saves, backups, settings
      - palworld-config:/config
      # Server files: cached between restarts for faster startup
      - palworld-server:/opt/palworld/server

    # =========================================================================
    # CONTAINER SETTINGS (usually don't need to change)
    # =========================================================================

    # Graceful shutdown timeout (allows world save)
    stop_grace_period: 2m

    # Restart policy
    restart: unless-stopped

    # Resource limits
    deploy:
      resources:
        limits:
          memory: 16G
        reservations:
          memory: 8G

    # Allow setting thread priority (improves performance)
    cap_add:
      - SYS_NICE

    # Logging configuration
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

# =============================================================================
# VOLUMES
# =============================================================================
volumes:
  palworld-config:
    name: absolute-palworld-server_palworld-config

  palworld-server:
    name: absolute-palworld-server_palworld-server
